<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Apresentação - Print</title>
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600;700;800&display=swap" rel="stylesheet">
    <style>
        /* Reset */
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Poppins', sans-serif;
            background: white;
        }

        /* Configuração de página A4 landscape */
        @page {
            size: A4 landscape;
            margin: 0;
        }

        /* Cada slide ocupa uma página inteira */
        .slide {
            width: 297mm;
            height: 210mm;
            page-break-after: always;
            break-after: page;
            overflow: hidden;
            position: relative;
            background: white;
        }

        /* Último slide não precisa de quebra */
        .slide:last-child {
            page-break-after: avoid;
            break-after: avoid;
        }

        /* Remover animações/transições na impressão */
        @media print {
            * {
                animation: none !important;
                transition: none !important;
                filter: none !important;
                -webkit-print-color-adjust: exact !important;
                print-color-adjust: exact !important;
            }

            body {
                background: white;
            }

            .slide {
                page-break-after: always;
                break-after: page;
            }
        }

        /* Loader (apenas para desenvolvimento) */
        #loader {
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            font-size: 24px;
            color: #2563A8;
        }

        @media print {
            #loader {
                display: none !important;
            }
        }
    </style>
</head>
<body>
    <div id="loader">Carregando apresentação...</div>
    <div id="printContainer"></div>

    <!-- Firebase -->
    <script type="module">
        import { initializeApp } from 'https://www.gstatic.com/firebasejs/10.8.0/firebase-app.js';
        import { getFirestore, doc, getDoc } from 'https://www.gstatic.com/firebasejs/10.8.0/firebase-firestore.js';
        
        // Configuração Firebase
        const firebaseConfig = {
            apiKey: "AIzaSyB3-n3WIdEOhCxvpbigs_ogse7b3tggGGU",
            authDomain: "insightflow-82cc4.firebaseapp.com",
            projectId: "insightflow-82cc4",
            storageBucket: "insightflow-82cc4.firebasestorage.app",
            messagingSenderId: "945960175733",
            appId: "1:945960175733:web:70345b9cf08a553db2d03c"
        };

        // Inicializar Firebase
        const app = initializeApp(firebaseConfig);
        const db = getFirestore(app);

        // Pegar ID da apresentação da URL
        const urlParams = new URLSearchParams(window.location.search);
        const presentationId = urlParams.get('id');
        const projectId = urlParams.get('projectId');

        async function loadPresentation() {
            try {
                if (!presentationId || !projectId) {
                    throw new Error('ID da apresentação ou projeto não fornecido');
                }

                // Buscar apresentação do Firestore
                const docRef = doc(db, `projects/${projectId}/presentations/${presentationId}`);
                const docSnap = await getDoc(docRef);

                if (!docSnap.exists()) {
                    throw new Error('Apresentação não encontrada');
                }

                const data = docSnap.data();
                const html = data.html || '';

                // Injetar HTML no container
                const container = document.getElementById('printContainer');
                container.innerHTML = html;

                // Adicionar classe .slide a todas as páginas
                const pages = container.querySelectorAll('.page');
                pages.forEach(page => {
                    page.classList.add('slide');
                });

                // Aguardar carregamento de fontes e imagens
                await document.fonts.ready;
                await waitForImages();

                // Remover loader
                document.getElementById('loader').style.display = 'none';

                // Sinalizar que está pronto para impressão
                window.isPrintReady = true;

            } catch (error) {
                console.error('❌ Erro ao carregar apresentação:', error);
                document.getElementById('loader').innerHTML = `Erro: ${error.message}`;
            }
        }

        function waitForImages() {
            const images = Array.from(document.images);
            return Promise.all(
                images.map(img => {
                    if (img.complete) return Promise.resolve();
                    return new Promise(resolve => {
                        img.onload = resolve;
                        img.onerror = resolve; // Continuar mesmo se imagem falhar
                    });
                })
            );
        }

        // Carregar apresentação ao abrir a página
        loadPresentation();
    </script>
</body>
</html>

